<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Site Trading - Chargement...</title> 
    
    <style>
        /* Styles omis pour la concision, mais ils sont les m√™mes que pr√©c√©demment (Style TradeLingo) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            padding: 20px;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        p {
            font-size: 0.9em;
            color: #888;
        }
        
        .tradingview-widget-container {
            max-width: 1200px;
            margin: 20px auto;
            border-radius: 8px;
            padding: 0; 
            transition: background-color 0.3s;
        }
        
        .controls {
            margin-bottom: 30px;
        }
        .footer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px; /* R√©duit le padding sur mobile */
            height: 50px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 100;
        }
        .menu-control{
            display: flex;
            gap: 5px; /* R√©duit l'espace entre les boutons */
            align-items: center;
        }
        #home-btn {
            width: 35px;
            height: 35px;
            
            background: var(--bg-primary);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 5px 8px; /* R√©duit le padding */
            border-radius: 50%; /* L√©g√®rement plus petit */
            cursor: pointer;
            font-size: 200%; /* R√©duit la taille de police */
            transition: background-color 0.2s, border-color 0.2s;
            white-space: nowrap; 
        }

        #theme-toggle {
            padding: 10px 25px;
            border: none;
            border-radius: 25px; 
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            letter-spacing: 0.5px;
            transition: opacity 0.2s;
        }
        #theme-toggle:hover {
            opacity: 0.8;
        }
        
        html[data-theme='dark'] body {
            background-color: #121212;
            color: #E0E0E0;
        }
        html[data-theme='dark'] h1 {
            color: #FFFFFF;
        }
        html[data-theme='dark'] .tradingview-widget-container {
            background-color: #1E1E1E;
        }
        html[data-theme='dark'] #theme-toggle {
            background-color: #B300FF; 
            color: white;
        }

        html[data-theme='light'] body {
            background-color: #F8F8F8;
            color: #333;
        }
        html[data-theme='light'] h1 {
            color: #1A1A1A;
        }
        html[data-theme='light'] .tradingview-widget-container {
            background-color: #FFFFFF;
        }
        html[data-theme='light'] #theme-toggle {
            background-color: #6C5CE7;
            color: white;
        }
    </style>
</head>
<body>

    <h1 id="main-title">üìà Graphique Avanc√©...</h1> 

    <div class="controls">
        <button id="theme-toggle" onclick="toggleTheme()">Passer en Mode Clair ‚òÄÔ∏è</button>
    </div>

    <div class="tradingview-widget-container">
        <div id="tradingview_chart_widget"></div> 

      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
      <script type="text/javascript">
      
      let tvWidget = null;
      let currentTheme = 'dark';
      // D√©finir le symbole par d√©faut (celui qui est sur la capture d'√©cran)
      const defaultSymbol = "BINANCE:BTCUSDT"; 

      // ----------------------------------------------------
      // 1. Fonction pour mettre √† jour le titre
      // ----------------------------------------------------
      function updateTitle(symbolName) {
          // Retire le pr√©fixe de la bourse (ex: 'FX:', 'BINANCE:')
          const cleanSymbol = symbolName.split(':')[1] || symbolName; 
          
          document.getElementById('main-title').innerText = `üìà Graphique Avanc√© ${cleanSymbol}`;
          document.title = `${cleanSymbol} - Analyse de Trading`; 
      }

      // ----------------------------------------------------
      // 2. Fonction d'initialisation du widget TradingView
      // ----------------------------------------------------
      function initWidget(theme) {
          const container = document.getElementById('tradingview_chart_widget');
          // On s'assure que le conteneur est vide avant de le recr√©er (n√©cessaire pour le changement de th√®me)
          container.innerHTML = ''; 
          
          tvWidget = new TradingView.widget(
          {
            "width": "100%",
            "height": "600",
            "symbol": defaultSymbol, 
            "interval": "D",
            "timezone": "Europe/Paris",
            "theme": theme, 
            "style": "1",
            "locale": "fr",
            "toolbar_bg": (theme === 'dark' ? "#1E1E1E" : "#F8F8F8"),
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_chart_widget"
            // REMARQUE: onSymbolChange est omis car non support√© par ce widget.
          });
          
          // D√©marre l'observateur apr√®s le chargement initial du widget
          observeSymbolChange();
          updateTitle(defaultSymbol);
      }

      // ----------------------------------------------------
      // 3. NOUVELLE FONCTION CL√â : Observer le changement du symbole
      // ----------------------------------------------------
      function observeSymbolChange() {
          const targetNode = document.getElementById('tradingview_chart_widget');
          
          // V√©rifie si le conteneur existe
          if (!targetNode) return;

          // Configure l'observateur de mutation
          const config = { attributes: true, attributeFilter: ['data-symbol'] };

          const callback = function(mutationsList, observer) {
              for(const mutation of mutationsList) {
                  if (mutation.type === 'attributes' && mutation.attributeName === 'data-symbol') {
                      const newSymbol = mutation.target.getAttribute('data-symbol');
                      // Mise √† jour si un nouveau symbole valide est trouv√©
                      if (newSymbol) {
                          updateTitle(newSymbol);
                      }
                  }
              }
          };

          // Cr√©e l'instance d'observateur
          const observer = new MutationObserver(callback);

          // D√©marre l'observation du n≈ìud cible
          observer.observe(targetNode, config);
      }
      
      // ----------------------------------------------------
      // 4. Fonction de bascule du th√®me
      // ----------------------------------------------------
      function toggleTheme() {
          const htmlElement = document.documentElement;
          const toggleButton = document.getElementById('theme-toggle');

          if (currentTheme === 'dark') {
              currentTheme = 'light';
              htmlElement.setAttribute('data-theme', 'light');
              toggleButton.innerHTML = "Passer en Mode Sombre üåô";
          } else {
              currentTheme = 'dark';
              htmlElement.setAttribute('data-theme', 'dark');
              toggleButton.innerHTML = "Passer en Mode Clair ‚òÄÔ∏è";
          }
          // L'observateur sera red√©marr√© dans initWidget
          initWidget(currentTheme); 
      }

      // Initialisation au chargement de la page
      document.addEventListener('DOMContentLoaded', () => {
          // Initialise le widget avec le symbole BTCUSDT par d√©faut
          initWidget(currentTheme); 
          document.getElementById('theme-toggle').innerHTML = "Passer en Mode Clair ‚òÄÔ∏è";
      });

      </script>
    </div>

    <p style="margin-top: 40px;">Ce graphique est fourni gratuitement par TradingView.</p>
    <footer class="footer">
        <div class="menu-control">
            <a href="index.html"><button id="home-btn">üè†</button></a>
            <a href="extrade.html"><button id="home-btn">üí∏</button></a>
        </div>
    </footer>
</body>
</html>
