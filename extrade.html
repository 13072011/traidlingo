<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Site Trading - Chargement...</title> 
    
    <style>
        /* D√©finition des variables CSS pour une gestion facile des th√®mes */
        :root {
            /* Variables par d√©faut (Mode Clair) */
            --bg-primary: #F8F8F8;
            --bg-secondary: #FFFFFF;
            --border-color: #E0E0E0;
            --text-color: #333333;
            --text-secondary: #888;
            --accent-color: #6C5CE7; /* Violet Clair */
            --chart-bg: #FFFFFF;
        }

        /* Surcharge des variables pour le Mode Sombre */
        html[data-theme='dark'] {
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --border-color: #333333;
            --text-color: #E0E0E0;
            --text-secondary: #AAAAAA;
            --accent-color: #B300FF; /* Violet Profond */
            --chart-bg: #1E1E1E;
        }

        /* Styles de base */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            padding: 70px 20px 20px 20px; /* Ajout d'un padding en haut pour la barre de navigation fixe */
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
            background-color: var(--bg-primary);
            color: var(--text-color);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            transition: color 0.3s;
            color: var(--text-color);
        }

        p {
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        /* Conteneur du graphique */
        .tradingview-widget-container {
            max-width: 1200px;
            margin: 20px auto;
            border-radius: 8px;
            padding: 0; 
            transition: background-color 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden; /* Pour contenir le widget TradingView */
            background-color: var(--chart-bg);
        }
        
        .controls {
            margin-bottom: 30px;
        }
        
        /* Barre de navigation fixe (Rempla√ßant l'ancien .footer) */
        .nav-header { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px; 
            height: 50px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .menu-control{
            display: flex;
            gap: 10px; 
            align-items: center;
        }
        
        /* Boutons de navigation (üè† et üí∏) */
        #home-btn {
            width: 38px;
            height: 38px;
            line-height: 38px; /* Pour centrer l'ic√¥ne */
            background: var(--bg-primary);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            padding: 0; 
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.2s, border-color 0.2s, transform 0.1s;
        }
        #home-btn:hover {
            border-color: var(--accent-color);
            transform: scale(1.05);
        }
        
        /* Bouton de bascule du th√®me */
        #theme-toggle {
            padding: 10px 25px;
            border: none;
            border-radius: 25px; 
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            letter-spacing: 0.5px;
            transition: opacity 0.2s;
            background-color: var(--accent-color);
            color: white;
        }
        #theme-toggle:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>

    <header class="nav-header"> <div class="menu-control">
            <a href="index.html"><button id="home-btn" title="Accueil">üè†</button></a>
            <a href="extrade.html"><button id="home-btn" title="Graphique">üí∏</button></a>
        </div>
    </header>

    <h1 id="main-title">üìà Graphique Avanc√©...</h1> 

    <div class="controls">
        <button id="theme-toggle" onclick="toggleTheme()">Passer en Mode Clair ‚òÄÔ∏è</button>
    </div>

    <div class="tradingview-widget-container">
        <div id="tradingview_chart_widget"></div> 

      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
      <script type="text/javascript">
      
      let tvWidget = null;
      // R√©cup√©rer le th√®me initial √† partir de l'attribut HTML
      let currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';

      // D√©finir le symbole par d√©faut (celui qui est sur la capture d'√©cran)
      const defaultSymbol = "BINANCE:BTCUSDT"; 

      // ----------------------------------------------------
      // 1. Fonction pour mettre √† jour le titre
      // ----------------------------------------------------
      function updateTitle(symbolName) {
          // Retire le pr√©fixe de la bourse (ex: 'FX:', 'BINANCE:')
          const cleanSymbol = symbolName.split(':')[1] || symbolName; 
          
          document.getElementById('main-title').innerText = `üìà Graphique Avanc√© ${cleanSymbol}`;
          document.title = `${cleanSymbol} - Analyse de Trading`; 
      }

      // ----------------------------------------------------
      // 2. Fonction d'initialisation du widget TradingView
      // ----------------------------------------------------
      function initWidget(theme) {
          const container = document.getElementById('tradingview_chart_widget');
          // On s'assure que le conteneur est vide avant de le recr√©er (n√©cessaire pour le changement de th√®me)
          container.innerHTML = ''; 
          
          // La couleur de la barre d'outils doit correspondre au fond de la barre de navigation (.nav-header)
          const toolbarBg = (theme === 'dark' ? "#1E1E1E" : "#FFFFFF"); 
          
          tvWidget = new TradingView.widget(
          {
            "width": "100%",
            "height": "600",
            "symbol": defaultSymbol, 
            "interval": "D",
            "timezone": "Europe/Paris",
            "theme": theme, 
            "style": "1",
            "locale": "fr",
            "toolbar_bg": toolbarBg,
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_chart_widget"
            // REMARQUE: onSymbolChange est omis car non support√© par ce widget.
          });
          
          // D√©marre l'observateur apr√®s le chargement initial du widget
          observeSymbolChange();
          updateTitle(defaultSymbol);
      }

      // ----------------------------------------------------
      // 3. NOUVELLE FONCTION CL√â : Observer le changement du symbole
      // ----------------------------------------------------
      function observeSymbolChange() {
          const targetNode = document.getElementById('tradingview_chart_widget');
          
          // V√©rifie si le conteneur existe
          if (!targetNode) return;

          // Configure l'observateur de mutation
          const config = { attributes: true, attributeFilter: ['data-symbol'] };

          const callback = function(mutationsList, observer) {
              for(const mutation of mutationsList) {
                  if (mutation.type === 'attributes' && mutation.attributeName === 'data-symbol') {
                      const newSymbol = mutation.target.getAttribute('data-symbol');
                      // Mise √† jour si un nouveau symbole valide est trouv√©
                      if (newSymbol) {
                          updateTitle(newSymbol);
                      }
                  }
              }
          };

          // Cr√©e l'instance d'observateur
          const observer = new MutationObserver(callback);

          // D√©marre l'observation du n≈ìud cible
          observer.observe(targetNode, config);
      }
      
      // ----------------------------------------------------
      // 4. Fonction de bascule du th√®me
      // ----------------------------------------------------
      function toggleTheme() {
          const htmlElement = document.documentElement;
          const toggleButton = document.getElementById('theme-toggle');

          if (currentTheme === 'dark') {
              currentTheme = 'light';
              htmlElement.setAttribute('data-theme', 'light');
              toggleButton.innerHTML = "Passer en Mode Sombre üåô";
          } else {
              currentTheme = 'dark';
              htmlElement.setAttribute('data-theme', 'dark');
              toggleButton.innerHTML = "Passer en Mode Clair ‚òÄÔ∏è";
          }
          // L'observateur sera red√©marr√© dans initWidget
          initWidget(currentTheme); 
      }

      // Initialisation au chargement de la page
      document.addEventListener('DOMContentLoaded', () => {
          // D√©finir le texte initial du bouton en fonction du th√®me initial
          if (currentTheme === 'dark') {
             document.getElementById('theme-toggle').innerHTML = "Passer en Mode Clair ‚òÄÔ∏è";
          } else {
             document.getElementById('theme-toggle').innerHTML = "Passer en Mode Sombre üåô";
          }
          // Initialise le widget avec le symbole BTCUSDT par d√©faut
          initWidget(currentTheme); 
      });

      </script>
    </div>

    <p style="margin-top: 40px;">Ce graphique est fourni gratuitement par TradingView.</p>
</body>
</html>
